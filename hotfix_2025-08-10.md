===== FILE: 2_architecture/privacy_security.md =====
# Privacy, Security & Compliance Design

- **Pseudonymization:** **Cohort-peppered HMACs** — `userId = HMAC_SHA256(cohortPepper[vX], E164(phone)|walletAlias)`. Peppers derived via HKDF, stored in **KMS/HSM**, rotated with `REKEY`.
- **Identity & keys:** **Magic.link** passkeys/WebAuthn (primary). OTP only assists discovery. Post-MVP: **DeRec** for social recovery.
- **Data minimization:** Store `reasonHash` on-chain; plaintext reasons are ephemeral for moderation only. No plaintext phone numbers.
- **Visibility:** Public shows **aggregate tag trends** per cohort; identities private unless both parties opt in.
- **Functional deletion:** On request, cease indexing a subject’s events and remove from aggregates; ledger entries remain for integrity.
- **Security controls:** Rate limits, spam filters, abuse reporting; anomaly alerts on key changes; delayed rebind after recovery.
- **Compliance:** **GDPR + CCPA**; campus pilots add **FERPA** notes. TCPA/10DLC for SMS **invites only**. DPIA/TIA templates maintained in `6_legal_compliance/`.
===== END FILE =====

===== FILE: 2_architecture/registry_contract_interface.md =====
# Trust Slot Registry — Contract Interface (Draft)

**Purpose:** On-chain guardrails for max **9 active commitments** per user; indexers verify and checkpoint.

## Storage
- `mapping(address user => uint16 slotsBitmap)`  // 9 LSB used
- `mapping(address user => uint64 nonceCounter)`

## Methods
- `commit(bytes32 digest, bytes sig)` — sets bit for `slotID` after verifying signature
- `unbond(bytes32 digest, bytes sig)` — marks slot pending (quiet unbond)
- `revoke(bytes32 digest, bytes sig)` — clears bit post-delay and sets `cooldownUntil`
- `checkpoint(bytes32 merkleRoot, bytes32 schemaHash)` — optional anchor to contract

## Security
- EIP-191 style digests include `{ chainId, topicId, slotID, nonce, expiry }`.
- Replay protection via `nonceCounter`.
- Contract SHOULD emit events mirrored by the HCS reducer for third-party verification.
===== END FILE =====
